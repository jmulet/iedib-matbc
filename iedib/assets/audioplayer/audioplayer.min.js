$(function(){function t(){var t=n=!0;window.onscroll=function(){var e=$("#pw-rt-content"),a=document.documentElement.scrollTop||document.body.scrollTop;300<a&&t&&(t=!1,e.fadeTo(500,0)),a<300&&!t&&(t=!0,e.fadeTo(500,1))}}var e,a,l={},i=' .pw-laser-nw{position:relative;}\n .pw-laser-nw::after{content:"";position:absolute;left:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',n=(i+=' .pw-laser-ne{position:relative;}\n .pw-laser-ne::after{content:"";position:absolute;right:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',i=' .pw-laser-nw{position:relative;}\n .pw-laser-nw::after{content:"";position:absolute;left:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n  .pw-laser-ne{position:relative;}\n .pw-laser-ne::after{content:"";position:absolute;right:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n  .pw-laser-sw{position:relative;}\n .pw-laser-sw::after{content:"";position:absolute;left:0;bottom:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;} \n .pw-laser-se{position:relative;}\n .pw-laser-se::after{content:"";position:absolute;right:0;bottom:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n  .pw-laser-md{position:relative;}\n .pw-laser-md::after{content:"";position:absolute;left:50%;bottom:50%;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n  .audible-media-player{max-width:600px;padding:6px;border-radius:7px;display:flex;margin:auto;margin-bottom:15px;}\n   \n .audible-frog span, .audible-frog button{color: #4f6e46;}\n .audible-sky{background:rgb(241,245,254);}\n .audible-frog{background:#e6ede6;}\n .audible-sky span, .audible-sky button{color:rgb(31,106,219);} \n  .pw-audible-btn{background: none; border: none; color: #4f6e46; margin: 0 5px;} \n .pw-pen-yellow{-webkit-box-shadow: #FFF 0 -1px 4px, #ff0 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #ff0 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(255,255,193,0.5);} \n  .pw-pen-green{-webkit-box-shadow: #FFF 0 -1px 4px, #3f3 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #3f3 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(193,255,200,0.5);}\n  .pw-pen-red{-webkit-box-shadow: #FFF 0 -1px 4px, #f33 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #f33 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(255,193,193,0.5);} \n   @media print{.audible-media-player{display:none;} }\n',(e="audible_css")&&document.getElementById(e)||((a=document.createElement("style")).type="text/css",a.innerHTML=i,e&&(a.id=e),document.getElementsByTagName("head")[0].appendChild(a)),$.fn.dedication=function(e){var a,t=this.attr("data-dedication")||"",i=$("#pw-rt-content");i.length?(a=$('<div title="Temps de dedicació recomanat per aquesta secció" data-toggle="tooltip" style="display:inline-block;margin:10px;padding:5px;border-radius:5px;background:rgb(241,245,254);color:rgb(31,106,219);"><i class="fad fa-stopwatch" aria-hidden="true"></i> <b>'+t+"</b></div>"),i.append(a)):(a=$('<div id="pw-rt-content" style="display: flex; justify-content: flex-end; align-items:center;"><div title="Temps de dedicació recomanat per aquesta secció" data-toggle="tooltip" style="display:inline-block;margin:10px;padding:5px;border-radius:5px;background:rgb(241,245,254);color:rgb(31,106,219);"><i class="fad fa-stopwatch" aria-hidden="true"></i> '+t+"</div></div>"),this.replaceWith(a))},$.fn.guidance=function(e){var t=this.attr("data-guidance")||"",a=this.attr("data-print")||"",i=this.attr("data-title")||"",n=t,o=[],s=!1,n=(n.startsWith("http")?(o.push(n),s=!0):(o.push((n="https://ibsuite.es/iedib/audible/"+t)+".m4a"),o.push(n+".mp3")),$("#pw-rt-content")),r=null;n.length?(r=$('<div style="display:inline-block;position:relative;"><div class="dropdown-toggle" title="Orientacions per a la secció" data-toggle="modal" data-target="#videoModal" style="cursor:pointer;margin:10px;padding:5px;border-radius:5px;background:rgb(241,245,254);color:rgb(31,106,219);"><i class="far fa-compass"></i></i> Orientacions</div><img src="https://ibsuite.es/iedib/img/pepavatar2.png" style="width:40px;position:absolute;top:-40px;left:10px;"></div>'),a&&n.append($('<a class="btn btn-outline-primary" data-toggle="tooltip" style="height:34px;" title="Versió optimitzada per a l\'impressió" href="'+a+'" target="_blank"><i class="fa fas fa-print"></i></a>')),n.append(r)):(n=$('<div id="pw-rt-content" style="display: flex; justify-content: flex-end;align-items:center;"></div>'),r=$('<div style="display: inline-block;position: relative;"><div class="dropdown-toggle" title="Orientacions per a la secció" data-toggle="modal" data-target="#videoModal" style="cursor:pointer;margin:10px;padding:5px;border-radius:5px;background:rgb(241,245,254);color:rgb(31,106,219);"><i class="far fa-compass"></i></i> Orientacions</div><img src="https://ibsuite.es/iedib/img/pepavatar2.png" style="width:40px;position:absolute;top:-40px;left:10px;"></div>'),a&&n.append($('<a class="btn btn-outline-primary" data-toggle="tooltip" style="height:34px;" title="Versió optimitzada per a l\'impressió" href="'+a+'" target="_blank"><i class="fa fas fa-print"></i></a>')),n.append(r),this.replaceWith(n)),s?(a=$("#videoModal")).length||(a=$('<div class="modal fade" id="videoModal" tabindex="-1" role="dialog"><div class="modal-dialog modal-dialog-centered modal-lg" role="document"><div class="modal-content"><div class="modal-header bg-dark border-dark"><span style="color:white;font-weight:bold;">'+i+'</span><button id="modalCloseBtn" type="button" class="close text-white" data-dismiss="modal">&times;</button></div><div class="modal-body bg-dark p-0"><div class="embed-responsive embed-responsive-16by9"><iframe id="iframeModal"  class="embed-responsive-item" src="'+o[0]+'?version=3&enablejsapi=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div></div></div></div>'),$("body").append(a),a.on("hide.bs.modal",function(){var e=$("#iframeModal");e.attr("src",e.attr("src"))}),$("#modalCloseBtn").on("click",function(){var e=$("#iframeModal");e.attr("src",e.attr("src"))})):(r.pwmplayer({id:t,src:o,css:"position:absolute;top:47px;right:10px;display:none;z-index:100;",skin:"sky"}),r.find(".dropdown-toggle").on("click",function(){var e=r.find(".audible-media-player"),a=(e.toggle(),l[t]);a&&("none"==e.css("display")?a.pause():a.play())}))},$.fn.overlaypen=function(e){this.old_display||(this.old_display=this.css("display")),this.old_position||(this.old_position=this.css("position")),this.css({position:"relative",display:"inline-block"});for(var a=$.extend({width:"15px",height:"60%",background:"orange",opacity:"0.37","z-index":"100","border-radius":"20%"},e),t=Object.keys(a),i=[],n=0,o=t.length;n<o;n++){var s=t[n];i.push(s+":"+a[s])}e=$('<div class="pw-overlaypen" style="position:absolute;'+i.join(";")+'"></div>');return this.append(e),this},$.fn.erasepen=function(){this.css({position:this.old_position,display:this.old_display}),this.find(".pw-overlaypen").remove()},$.fn.pwmplayer=function(e){if(!window.Audio)return this;var o=$.extend({id:"p"+Math.random().toString(32).substring(2),src:[],skin:"frog",css:""},e),e="",s=(o.css&&(e='style="'+o.css+'"'),!1),i=new Audio,a=(i.id=o.id,l[o.id]=i,$('<button class="pw-audible-btn" style="background: none; border: none; margin: 0 5px;" id="'+o.id+'_stop"><i class="fa fas fa-sync"></i></button>')),r=$('<input type="range" value="0" min="0" max="100" style="margin-left:5px;flex-grow:96;"/>'),d=$('<span style="margin-left:5px;font-family:arial;">00:00</span>'),t=$('<button style="background: none; border: none; margin: 0 5px;" class="pw-audible-btn"><i class="fa fas fa-play"></i></button>'),p=$('<div class="audible-media-player audible-'+o.skin+'" '+e+' id="pwmplayer_'+o.id+'" title="AudioPlayer by Josep Mulet"></div>');$.each(o.src,function(e,a){e=$('<source id="'+o.id+"_src"+e+'" src="'+a+'"></source>');$(i).append(e)}),i.load(),i.addEventListener("loadeddata",function(){var n=i.duration;a.on("click",function(e){i.pause(),$(t).html('<i class="fa fas fa-play"></i>'),i.currentTime=0,d.html("00:00"),r.val(0),o.onStop&&o.onStop()}),t.on("click",function(e){i.stopped=!1,i.paused?(i.play(),$(t).html('<i class="fa fas fa-pause"></i>')):(i.pause(),$(t).html('<i class="fa fas fa-play"></i>'))}),i.addEventListener("timeupdate",function(e){var a,t,i,e=e.target;s||(t=(a=Math.floor(e.currentTime))-60*(i=Math.floor(a/60)+"")+"",i.length<2&&(i="0"+i),t.length<2&&(t="0"+t),d.html(i+":"+t),i=Math.round(100*a/n),r.val(i),o.onTimeupdate&&o.onTimeupdate(e.currentTime))}),i.addEventListener("ended",function(e){$(e.target).val(100),$(t).html('<i class="fa fas fa-play"></i>'),d.html("00:00"),r.val(0),i.stopped=!0,i.currentTime=0}),r.on("mousedown",function(e){s=!0}),r.on("mouseup",function(e){s=!1}),r.on("change",function(e){var e=e.target,e=Math.floor(.01*$(e).val()*n),a=Math.floor(e/60)+"",t=e-60*a+"";a.length<2&&(a="0"+a),t.length<2&&(t="0"+t),d.html(a+":"+t),0==e&&d.html("00:00"),i.currentTime=e}),p.append(t),p.append(r),p.append(d),p.append(a)}),this.prepend(p)},$.fn.audible=function(e){var a=this,t=(a.find("a.accordion-toggle").append('<span title="Explicació en àudio"> narrada <i class="fa fas fa-headphones"></i></span>'),a.find(".accordion-inner")),i=a.attr("data-audible"),n=i,o=[],l=(n.startsWith("http")?o.push(n):(o.push((n="https://ibsuite.es/iedib/audible/"+i)+".m4a"),o.push(n+".mp3")),a.find("[data-from]")),c=a.find("[data-laser]"),u=a.find("[data-pen]");l.each(function(e,a){var t=$(a).attr("data-from");a.fromTime=t}),c.each(function(e,a){for(var t=$(a).attr("data-laser"),i=(a.lasers=[],t.split("|")),n=0,o=i.length;n<o;n++){var s,r,d,p=i[n],p=p.split(",");2<=p.length&&(d=r=0,s="md",r=parseInt(p[0]),d=parseInt(p[1]),2<p.length&&(s=(p[2]||"md").trim().toLowerCase()),a.lasers.push({start:r,end:d,pos:s}))}}),u.each(function(e,a){for(var t=$(a).attr("data-pen"),i=(a.pen=[],t.split("|")),n=0,o=i.length;n<o;n++){var s=i[n],s=s.split(",");if(3===s.length){for(var r={},d=parseInt(s[0]),p=parseInt(s[1]),l=s[2].split(";"),e=0,c=l.length;e<c;e++){var u,b=l[e].split(":");2==b.length&&(u=b[0].trim(),b=b[1].trim(),r[u]=b)}a.pen.push({start:d,end:p,opts:r})}}});t.pwmplayer({id:i,src:o,onTimeupdate:function(e){if(0==e)l.fadeTo("fast",1),c.removeClass("pw-laser-md").removeClass("pw-laser-nw").removeClass("pw-laser-ne").removeClass("pw-laser-sw").removeClass("pw-laser-se"),u.each(function(e,a){$(a).erasepen()});else{for(var a=0,t=l.length;a<t;a++)(s=l[a]).fromTime>e?$(s).fadeTo("fast",0):$(s).fadeTo("fast",1);for(a=0,t=c.length;a<t;a++){for(var i=null,n=0,o=(s=c[a]).lasers.length;n<o;n++)if((d=s.lasers[n]).start<=e&&e<=d.end){i=d.pos;break}i?$(s).addClass("pw-laser-"+i):$(s).removeClass("pw-laser-md").removeClass("pw-laser-nw").removeClass("pw-laser-ne").removeClass("pw-laser-sw").removeClass("pw-laser-se")}for(a=0,t=u.length;a<t;a++){var s=u[a],r=$(s);r.each(function(e,a){$(a).erasepen()});for(var d,p,n=0,o=s.pen.length;n<o;n++)(d=s.pen[n]).start<=e&&e<=d.end&&(p=d.opts)&&r.overlaypen(p)}}},onStop:function(){l.fadeTo("fast",1)}})},$("[data-audible]").each(function(e,a){$(a).audible()}),!1);($("div.page-header-headings > h1").html()||"").indexOf("PBAU")<0&&$("[data-dedication]").each(function(e,a){0!=e||n||t(),$(a).dedication()}),$("[data-guidance]").each(function(e,a){0==e&&$("div.no-overflow").css("overflow","initial"),0!=e||n||t(),$(a).guidance()})});